<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Explicit ESM in Node.js with .mjs</title>
  <meta name="description" content="A brief explainer on the usage of .mjs and .cjs in Node.js.">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/prism.ghcolors.css">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@bitandbang" />
<meta property="og:url" content="https://bnb.im/posts/explicit-esm-in-node-js-with-mjs/" />
<meta property="og:title" content="Explicit ESM in Node.js with .mjs" />
<meta property="og:description" content="A brief explainer on the usage of .mjs and .cjs in Node.js." />
<meta name="twitter:image" content="https://bnb.im/img/small-card.png" />
<meta property="og:image" content="https://bnb.im/img/small-card.png" />


</head>
<body class="mono">
  <header class="global">
    <section class="container">
      <section class=grow-4>
        <a href="/"><h1>Tierney Cyren</h1></a>
      </section>
      <nav>
        <a href="https://twitter.com/bitandbang" class="p-l-1rem">Twitter</a>
        <a href="https://github.com/bnb" class="p-l-1rem">GitHub</a>
      </nav>
    </section>
  </header>
  <section>
    <section class="post container column">
  <h1 class="post-title">Explicit ESM in Node.js with .mjs</h2>
  <sub>Originally posted on <time datetime="2021-06-16">16 Jun 2021</time> as part 1 of the <a href="/series/esm-in-node-js">ESM in Node.js</a> series.
</sub>
  <p>A while ago, Node.js introduced support for ECMAScript Modules (ESM). ESM is the <strong>standardized</strong> modules implementation that's been built-in to JavaScript. This differs rather significantly from CommonJS (CJS), which is the module system that Node.js has shipped with for over a decade that make them <em>relatively</em> incompatible.</p>
<p>There are a number of different components of Node.js that have been intentionally structured to allow you to use <strong>standard</strong> (as in, how the ECMAScript Specification defines it) ESM by default and extend/augment that experience if you'd like to.</p>
<p>Today, I want to get into one of the baisc elements of ESM in Node.js: the <code>.mjs</code> and <code>.cjs</code> extensions.</p>
<h2 id="why-.mjs-(and-.cjs)" tabindex="-1">Why <code>.mjs</code> (and <code>.cjs</code>)? <a class="direct-link" href="#why-.mjs-(and-.cjs)" aria-hidden="true">#</a></h2>
<h3 id="the-quick-answer" tabindex="-1">The Quick Answer <a class="direct-link" href="#the-quick-answer" aria-hidden="true">#</a></h3>
<p>The straightforward answer to this is that having different file extensions allows you to be explicit in how you want to run your code - <code>.mjs</code> will always be run as ESM, <code>.cjs</code> will always be run as CommonJS.</p>
<h3 id="the-answer-with-context" tabindex="-1">The Answer With Context <a class="direct-link" href="#the-answer-with-context" aria-hidden="true">#</a></h3>
<p>Because of the differences in how ESM and CommonJS work, Node.js runs them differently by default. This results in the runtime needing an indicator about which way you want to run your code - as ESM or as CommonJS.</p>
<p>There's three different ways that this indicator could be expressed: explicitly, implicitly, and by default.</p>
<p>To not break over a decade of projects and over a million modules that are expecting to Just Work, the default the project landed on was CommonJS - sensible, especially when you consider millions of lines of code and multitudes of applications already running in this way.</p>
<p>The way to <em>explicitly</em> assert that the code you're running is ESM and should be run as such is to just use the <code>.mjs</code> file extension (which, if you're concerned, is also supported in web browsers as long as the <code>Content-Type: text/javascript</code> header is sent and is actually <a href="https://v8.dev/features/modules#mjs">recommended by V8</a>). The official overview of this is documented in the <a href="https://nodejs.org/api/packages.html#packages_determining_module_system">determining module system</a> section of the Node.js Packages documentation.</p>
<p>When you use <code>.mjs</code>, Node.js <em>knows</em> that you've written ESM and will parse your JavaScript as such. The same is true for <code>.cjs</code> - Node.js <em>knows</em> that <code>.cjs</code> should run as CommonJS, and will parse your JavaScript as CommonJS.</p>

</section>
<section class="poke">
</section>
  </seciton>
  <footer></footer>
</body>
</html>